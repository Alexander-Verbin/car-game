document.addEventListener("DOMContentLoaded",(()=>{let e=!1,t=null,o=3,n=0;const r=document.querySelector(".car"),i={...w(r),move:{top:null,bottom:null,left:null,right:null}},l=document.querySelector(".coin"),c=w(l),m=document.querySelector(".danger"),s=w(m),a=document.querySelector(".road"),d=a.clientHeight,u=a.clientWidth/2,y=document.querySelector(".game-button"),h=document.querySelector(".game-score"),f=document.querySelector(".backdrop"),v=document.querySelector(".restart-button"),p=document.querySelectorAll(".tree"),A=[];for(let e=0;e<p.length;e++){const t=$(p[e]);A.push(t)}function w(e){return{coords:$(e),height:e.clientHeight,width:e.clientWidth/2,visible:!0}}function g(){const e=i.coords.y-5;e<0||(i.coords.y=e,b(i.coords.x,e),i.move.top=requestAnimationFrame(g))}function x(){const e=i.coords.y+5;e+i.height>d||(i.coords.y=e,b(i.coords.x,e),i.move.bottom=requestAnimationFrame(x))}function F(){const e=i.coords.x-5;e<-u+i.width||(i.coords.x=e,b(e,i.coords.y),i.move.left=requestAnimationFrame(F))}function q(){const e=i.coords.x+5;e>u-i.width||(i.coords.x=e,b(e,i.coords.y),i.move.right=requestAnimationFrame(q))}function b(e,t){r.style.transform=`translate(${e}px, ${t}px)`}function S(){if(L(m,s,-250),k(i,s))return E(),h.style.display="none",y.style.display="none",f.style.display="flex",void(f.querySelector(".finish-text-score").innerText=n);!function(){for(let e=0;e<p.length;e++){const t=p[e],n=A[e];let r=n.y+o;r>window.innerHeight&&(r=-370),A[e].y=r,t.style.transform=`translate(${n.x}px, ${r}px)`}}(),L(l,c,-100),c.visible&&k(i,c)&&(n++,h.innerText=n,l.style.display="none",c.visible=!1,n%3==0&&(o+=2)),t=requestAnimationFrame(S)}function L(e,t,n){let r=t.coords.y+o,i=t.coords.x;if(r>window.innerHeight){r=n;const o=parseInt(2*Math.random()),l=u+1-t.width,c=parseInt(Math.random()*l);0===o?i=-c:1===o&&(i=c),e.style.display="initial",t.visible=!0,i=0===o?-c:c}t.coords.y=r,t.coords.x=i,e.style.transform=`translate(${i}px, ${r}px)`}function $(e){const t=window.getComputedStyle(e).transform.split(","),o=t[t.length-1],n=t[t.length-2],r=parseFloat(o);return{x:parseFloat(n),y:r}}function k(e,t){const o=e.coords.y,n=e.coords.y+e.height,r=e.coords.x-e.width,i=e.coords.x+e.width,l=t.coords.y,c=t.coords.y+t.height,m=t.coords.x-t.width,s=t.coords.x+t.width;return!(o>c||n<l||r>s||i<m)}function E(){cancelAnimationFrame(t),cancelAnimationFrame(i.move.top),cancelAnimationFrame(i.move.bottom),cancelAnimationFrame(i.move.left),cancelAnimationFrame(i.move.right)}document.addEventListener("keydown",(t=>{if(e)return;const o=t.code;if("ArrowUp"===o&&null===i.move.top){if(i.move.bottom)return;i.move.top=requestAnimationFrame(g)}else if("ArrowDown"===o&&null===i.move.bottom){if(i.move.top)return;i.move.bottom=requestAnimationFrame(x)}else if("ArrowLeft"===o&&null===i.move.left){if(i.move.right)return;i.move.left=requestAnimationFrame(F)}else if("ArrowRight"===o&&null===i.move.right){if(i.move.left)return;i.move.right=requestAnimationFrame(q)}})),document.addEventListener("keyup",(e=>{const t=e.code;"ArrowUp"===t?(cancelAnimationFrame(i.move.top),i.move.top=null):"ArrowDown"===t?(cancelAnimationFrame(i.move.bottom),i.move.bottom=null):"ArrowLeft"===t?(cancelAnimationFrame(i.move.left),i.move.left=null):"ArrowRight"===t&&(cancelAnimationFrame(i.move.right),i.move.right=null)})),t=requestAnimationFrame(S),y.addEventListener("click",(()=>{e=!e,e?(E(),y.children[0].style.display="none",y.children[1].style.display="initial"):(t=requestAnimationFrame(S),y.children[0].style.display="initial",y.children[1].style.display="none")})),v.addEventListener("click",(()=>{window.location.reload()}))}));